"use strict";(globalThis.webpackChunkpage_render_service=globalThis.webpackChunkpage_render_service||[]).push([[3293],{3293:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var o=a(467),n=a(4705),r=a(765),s=a(4612),i=a(5058),l=a(8229),c=a(2367),d="https://storage.googleapis.com/wzreponsiveeditor-static-latest/images/maps",p={lat:40.861458,lng:-73.891037},m={default:"".concat(d,"/default_red.svg"),default_green:"".concat(d,"/default_green.svg"),default_blue:"".concat(d,"/default_blue.svg"),default_orange:"".concat(d,"/default_orange.svg"),arts:"".concat(d,"/arts.svg"),bars:"".concat(d,"/bars.svg"),camera:"".concat(d,"/camera.svg"),coffee:"".concat(d,"/coffee.svg"),convenience:"".concat(d,"/convenience.svg"),dining:"".concat(d,"/dining.svg"),flag:"".concat(d,"/flag.svg"),home:"".concat(d,"/home.svg"),salon:"".concat(d,"/salon.svg"),shopping:"".concat(d,"/shopping.svg")},g=function(){var e=(0,o.A)((function*(e){var{google:t}=window;if(t){var a=new t.maps.Geocoder;if(a)return new Promise(((o,n)=>{a.geocode({address:e},((e,a)=>{var{GeocoderStatus:r}=t.maps,{OK:s,ZERO_RESULTS:i}=r;if(a===s&&a!==i){var{location:l}=e[0].geometry,c=new t.maps.LatLng(l.lat(),l.lng());c?o(c):n(new Error("Geocoder error ".concat(a)))}}))}))}}));return function(t){return e.apply(this,arguments)}}(),u=e=>{var{lat:t,lng:a}=(e=>{if(!e.includes("http"))return{lat:null,lng:null};var t=e.slice(Math.max(0,e.indexOf("@")+1)).split(",");return{lat:t[0],lng:t[1]}})(e),{google:o}=window;return new o.maps.LatLng(t,a)};class v extends c.A{constructor(e){var t;super(e),t=this,(0,n.A)(this,"init",(()=>{var e=l.A.getCollection(this.selector);(0,i.A)(e)||e.forEach((e=>{var t=(0,r.A)(e,"dataset.settings",null);if(!(0,i.A)(t)){var a=JSON.parse(t);this.state.mapSettings=a,this.drawMap(e,a)}}))})),(0,n.A)(this,"drawMap",function(){var e=(0,o.A)((function*(e,a){var{google:o}=window,{mapTypeId:n,mapZoom:r,markers:s,zoomControl:i,draggableMap:l,clickableIcons:c,mapTypeControl:d}=a;if(o&&(!o||o.maps)){var m={zoom:r,mapTypeId:n.toLowerCase(),zoomControl:i,minZoom:4,maxZoom:21,scaleControl:!1,rotateControl:!1,mapTypeControl:d,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","terrain","hybrid"]},streetViewControl:!1,disableDoubleClickZoom:!1,fullscreenControl:!1,center:p,gestureHandling:l?"cooperative":"none",clickableIcons:c},u=new o.maps.Map(e,m),v=new o.maps.LatLngBounds;t.state.firstMarkerPosition=yield g(s[0].address),yield t.makeMarkers(s,u,v),s.length>0&&u.panTo(v.getCenter())}}));return function(t,a){return e.apply(this,arguments)}}()),(0,n.A)(this,"makeMarkers",function(){var e=(0,o.A)((function*(e,a,o){(0,s.A)(e)||e.map(((e,n)=>{t.setPosition(e,a,o,n)}))}));return function(t,a,o){return e.apply(this,arguments)}}()),(0,n.A)(this,"setPosition",function(){var e=(0,o.A)((function*(e,a,o,n){var r;(null==(r=e.address)?void 0:r.includes("http"))?t.setPositionFromURL(e,a,o,n):yield t.setPositionFromAddress(e,a,o,n)}));return function(t,a,o,n){return e.apply(this,arguments)}}()),(0,n.A)(this,"handleZoom",(e=>{var{markers:t,mapZoom:a}=this.state.mapSettings,o=e.getZoom(),n=t.length>1?o:a;e.setZoom(n)})),(0,n.A)(this,"moveMapCenterToFirstMarkerWhenMarkersAreTooFarAway",((e,t)=>{e.getBounds().contains(t.getPosition())||e.panTo(this.state.firstMarkerPosition)})),(0,n.A)(this,"drawMarker",((e,t,a,o,n)=>{var{google:r}=window,s=new r.maps.Marker({map:a,position:e,title:(null==t?void 0:t.title)||"",icon:m[null==t?void 0:t.markerType]||m.default,zIndex:n||1}),i='<div class="map-marker"><div class="map-marker__title">'.concat(t.title||"",'</div><div class="map-marker__desc">').concat(t.description||"","</div></div>"),l=new r.maps.InfoWindow({content:i,maxWidth:648});s.addListener("click",(()=>{l.open({anchor:s,map:a})})),o&&(a.setOptions({maxZoom:15}),o.extend(e),a.fitBounds(o),a.setOptions({maxZoom:21})),this.moveMapCenterToFirstMarkerWhenMarkersAreTooFarAway(a,s),this.handleZoom(a)})),this.state={mapSettings:{},firstMarkerPosition:{}}}setPositionFromURL(e,t,a,o){var n=u(e.address);this.drawMarker(n,e,t,a,o)}setPositionFromAddress(e,t,a,n){var r=this;return(0,o.A)((function*(){var o=yield g(e.address);r.drawMarker(o,e,t,a,n)}))()}}const h=v}}]);